# lec5 SPOC思考题


NOTICE
- 有"w3l1"标记的题是助教要提交到学堂在线上的。
- 有"w3l1"和"spoc"标记的题是要求拿清华学分的同学要在实体课上完成，并按时提交到学生对应的git repo上。
- 有"hard"标记的题有一定难度，鼓励实现。
- 有"easy"标记的题很容易实现，鼓励实现。
- 有"midd"标记的题是一般水平，鼓励实现。


## 个人思考题
---

请简要分析最优匹配，最差匹配，最先匹配，buddy systemm分配算法的优势和劣势，并尝试提出一种更有效的连续内存分配算法 (w3l1)
```
  + 采分点：说明四种算法的优点和缺点
  - 答案没有涉及如下3点；（0分）
  - 正确描述了二种分配算法的优势和劣势（1分）
  - 正确描述了四种分配算法的优势和劣势（2分）
  - 除上述两点外，进一步描述了一种更有效的分配算法（3分）
 ```
- [x]  

>  
* 最先匹配：优势，简单，在高地址空间有大块的空闲分区，缺点：存在大量外部碎片，在分配大块空间时需要较多时间。  
* 最差匹配：优势，中等大小的分配较多时效果最好，避免出现太多的小碎片，缺点：释放分区较慢，存在很多外部碎片，后续难以分配大的分区。  
* 最佳匹配：优点：大部分分配的尺寸较小时，效果很好， 即可以避免大的空闲分区被拆分，可减小外部随便大小。缺点：仍存在  
大量小的外部碎片，释放分区较慢。  
* buddy systemm： 优点：可以避免大的空闲分区被拆分，可减小外部随便大小，类似于最佳算法，不容易产生大量小的外部碎片。缺点：  
释放分区较慢，实现稍复杂。
* 提出一个连续内存分配算法：内存最小单元变大，比如由一字节变为1024字节，分配时以1024字节为单位进行分配，在此基础上利用最佳分配算法进行分配，这样不存在特别小的外部碎片。

## 小组思考题

请参考ucore lab2代码，采用`struct pmm_manager` 根据你的`学号 mod 4`的结果值，选择四种（0:最优匹配，1:最差匹配，2:最先匹配，3:buddy systemm）分配算法中的一种或多种，在应用程序层面(可以 用python,ruby,C++，C，LISP等高语言)来实现，给出你的设思路，并给出测试用例。 (spoc)

> 写了一个简单的结构性代码,有一个struct类型的page，这个page可以进一步扩展，有start,end,size等等信息，而全局维护的有两个表，分别时used_和free_这两个表，这两个表记录了所有的已经分配的内存和没有分配的内存，这个表按照内存块的大小进行维护，并使得最大的块位于最前面。<br />
当要进行内存分配时，直接和第一个空着的内存块比较大小，因为这个时最差匹配，而在比较完之后，如果是小于这个的话，则需要

## 扩展思考题

阅读[slab分配算法](http://en.wikipedia.org/wiki/Slab_allocation)，尝试在应用程序中实现slab分配算法，给出设计方案和测试用例。


